name: Bus Ticket Monitor

on:
  schedule:
    - cron: "*/1 * * * *"  # Run every 1 minute
  workflow_dispatch:  # Allows manual trigger

jobs:
  monitor_bus_tickets:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.9"

      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install pushbullet.py requests

      - name: Check for Previous Cache
        run: |
          if [ ! -f ticket_cache.json ]; then
            echo "No ticket cache found, initializing..."
            touch ticket_cache.json
          else
            echo "Ticket cache found."
          fi

      - name: Download Previous Cache (if exists)
        uses: actions/download-artifact@v4
        with:
          name: ticket-cache
          path: ./  # Download to current directory
        continue-on-error: true  # Continue even if no artifact exists

      - name: Run Ticket Checker
        run: python main.py  # Run the script

      - name: Upload Updated Cache
        uses: actions/upload-artifact@v4
        with:
          name: ticket-cache
          path: ticket_cache.json  # Save updated cache after job runs
